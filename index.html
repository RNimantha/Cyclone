<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyclone Relief Fund – University of Colombo, Faculty of Science, 2016/17 Batch</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'Cyclone Relief Fund Dashboard',
            page_location: window.location.href
        });
        
        // Track page views
        gtag('event', 'page_view', {
            page_title: 'Cyclone Relief Fund Dashboard',
            page_location: window.location.href
        });
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .logo-container {
            margin-bottom: 20px;
        }

        .logo-container img {
            max-height: 120px;
            max-width: 120px;
            height: auto;
            width: auto;
            object-fit: contain;
        }

        h1 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .description {
            color: #555;
            font-size: 1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.7;
        }

        .program-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .program-details-header {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .program-details-header:hover {
            background-color: #f8f9fa;
        }

        .program-details h3 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.2rem;
            text-align: center;
        }

        .program-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .program-details-content.expanded {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }

        .program-details-toggle {
            font-size: 1.2rem;
            color: #2c3e50;
            transition: transform 0.3s;
        }

        .program-details-toggle.expanded {
            transform: rotate(180deg);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            border: 1px solid #e0e0e0;
        }

        .card-title {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .card-value.large {
            font-size: 2.5rem;
            color: #27ae60;
        }

        .progress-container {
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid #ddd;
        }

        .progress-fill {
            height: 100%;
            background: #27ae60;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
            min-width: 80px;
            position: relative;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        .progress-bar-wrapper {
            position: relative;
        }
        
        .progress-percentage-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #2c3e50;
            font-weight: 700;
            font-size: 1.1rem;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .progress-text {
            margin-top: 8px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .bank-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }

        .bank-details p {
            margin: 8px 0;
            font-size: 1rem;
        }

        .bank-details strong {
            color: #2c3e50;
            display: inline-block;
            min-width: 140px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        tbody tr:nth-child(even) {
            background: #fafafa;
        }

        .receipt-link {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .receipt-link:hover {
            text-decoration: underline;
        }

        .status {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #666;
            font-size: 0.85rem;
            border: 1px solid #e0e0e0;
        }

        .status.loading {
            color: #3498db;
        }

        .status.error {
            color: #c0392b;
            background: #fee;
            border-color: #fcc;
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .chart-label {
            min-width: 100px;
            font-size: 0.9rem;
            color: #666;
        }

        .chart-visual {
            flex: 1;
            height: 25px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 10px;
            border: 1px solid #ddd;
        }

        .chart-fill {
            height: 100%;
            background: #3498db;
        }

        .chart-value {
            min-width: 80px;
            text-align: right;
            font-weight: 600;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .logo-container img {
                max-height: 100px;
                max-width: 100px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .card-value {
                font-size: 1.5rem;
            }

            .card-value.large {
                font-size: 2rem;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px;
            }

            .bank-details strong {
                min-width: 100px;
                display: block;
                margin-bottom: 5px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="University of Colombo Logo" id="logo">
            </div>
            <h1>Cyclone Relief Fund</h1>
            <p style="font-size: 1.1rem; color: #2c3e50; font-weight: 600; margin-bottom: 10px;">
                University of Colombo, Faculty of Science<br>
                2016/17 Batch Initiative
            </p>
            <p class="description">
                This initiative is organized by the University of Colombo, Faculty of Science, 2016/17 batch to support people affected by the recent floods. 
                We have selected <strong>Rambodagama Primary School</strong> for this program, which has approximately <strong>50 children</strong> studying there. 
                The school is primarily seeking <strong>mental and emotional support for the children</strong> rather than material aid alone.
            </p>
            
            <div class="program-details">
                <div class="program-details-header" onclick="toggleProgramDetails()">
                    <h3>Program Activities</h3>
                    <span class="program-details-toggle" id="programToggle">▼</span>
                </div>
                
                <div class="program-details-content" id="programContent" style="text-align: left; max-width: 800px; margin: 0 auto;">
                    <p style="margin-bottom: 12px; color: #555;">
                        <strong>Main Programme:</strong> Psychological First Aid Programme
                    </p>
                    
                    <p style="margin-bottom: 12px; color: #555;">
                        <strong>Primary Donation:</strong> 2 computers for the school along with sports items
                    </p>
                    
                    <p style="margin-bottom: 12px; color: #555;">
                        <strong>Secondary Donation:</strong> One storybook for each child
                    </p>
                    
                    <p style="margin-bottom: 12px; color: #555;">
                        <strong>Additional Activities:</strong> Lunch for the children, fun games session, arts session, musical programme, and Shramadana (voluntary community service)
                    </p>
                    
                    <p style="margin-top: 20px; margin-bottom: 0; color: #2c3e50; font-weight: 600;">
                        Program Dates: <strong>December 27th and 28th</strong>
                    </p>
                </div>
            </div>
        </header>

        <div class="dashboard">
            <div class="card">
                <div class="card-title">Total Collected</div>
                <div class="card-value large" id="totalAmount">LKR 0</div>
            </div>
            <div class="card">
                <div class="card-title">Target Amount</div>
                <div class="card-value">LKR 600,000</div>
            </div>
            <div class="card">
                <div class="card-title">Total Donors</div>
                <div class="card-value" id="totalDonors">0</div>
            </div>
            <div class="card">
                <div class="card-title">Progress</div>
                <div class="progress-container">
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                        </div>
                        <div class="progress-percentage-overlay" id="progressOverlay">0%</div>
                    </div>
                    <div class="progress-text" id="progressText">0% of target reached</div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">Remaining Amount</div>
                <div class="card-value" id="remainingAmount">LKR 600,000</div>
            </div>
            <div class="card" style="display: none;">
                <div class="card-title">Average Donation</div>
                <div class="card-value" id="averageDonation">LKR 0</div>
            </div>
            <div class="card">
                <div class="card-title">Days Remaining</div>
                <div class="card-value" id="daysRemaining">0 days</div>
            </div>
        </div>

        <div class="section" style="display: none;">
            <h2>Bank Account Details</h2>
            <div class="bank-details">
                <p><strong>Account Number:</strong> 8000729815</p>
                <p><strong>Account Name:</strong> I D M R Nimantha Bandara</p>
                <p><strong>Bank:</strong> Commercial Bank – Rajagiriya</p>
            </div>
        </div>

        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">Donation Records</h2>
                <div style="display: flex; gap: 10px;">
                    <button id="downloadPdfBtn" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: background 0.2s;" onmouseover="this.style.background='#2980b9'" onmouseout="this.style.background='#3498db'">
                        Download PDF
                    </button>
                </div>
            </div>
            <div id="lastUpdated" style="margin-bottom: 15px; color: #666; font-size: 0.9rem;"></div>
            <div style="margin-bottom: 10px; display: flex; gap: 10px;">
                <button id="sortByAmountBtn" style="padding: 8px 16px; background: #f8f9fa; color: #2c3e50; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 0.85rem; transition: all 0.2s;" onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                    Sort by Amount <span id="sortIndicator">↓</span>
                </button>
                <button id="sortByTimestampBtn" style="padding: 8px 16px; background: #f8f9fa; color: #2c3e50; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 0.85rem; transition: all 0.2s;" onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                    Sort by Timestamp <span id="sortTimestampIndicator">↕</span>
                </button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Donor Name</th>
                        <th>Amount (LKR)</th>
                        <th>Receipt</th>
                    </tr>
                </thead>
                <tbody id="donationTable">
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #999;">
                            Loading donations...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Progress Visualization</h2>
            <div class="chart-container">
                <div class="chart-bar">
                    <div class="chart-label">Collected</div>
                    <div class="chart-visual">
                        <div class="chart-fill" id="chartFill" style="width: 0%"></div>
                    </div>
                    <div class="chart-value" id="chartValue">LKR 0</div>
                </div>
            </div>
        </div>

        <div id="status" class="status loading" style="display: none;">Loading donation data...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Visitor tracking
        function trackVisit() {
            // Generate or get visitor ID
            let visitorId = localStorage.getItem('visitorId');
            if (!visitorId) {
                visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('visitorId', visitorId);
            }
            
            // Get visit information
            const visit = {
                visitorId: visitorId,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer || 'Direct',
                url: window.location.href,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height
            };
            
            // Store visit
            const visits = JSON.parse(localStorage.getItem('visits') || '[]');
            visits.push(visit);
            
            // Keep only last 1000 visits
            if (visits.length > 1000) {
                visits.shift();
            }
            
            localStorage.setItem('visits', JSON.stringify(visits));
        }
        
        // Track events (exposed globally for app.js)
        window.trackLocalEvent = function(eventType, label) {
            const event = {
                type: eventType,
                label: label || '',
                timestamp: new Date().toISOString(),
                visitorId: localStorage.getItem('visitorId') || 'unknown'
            };
            
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            events.push(event);
            
            // Keep only last 500 events
            if (events.length > 500) {
                events.shift();
            }
            
            localStorage.setItem('events', JSON.stringify(events));
        };
        
        function toggleProgramDetails() {
            const content = document.getElementById('programContent');
            const toggle = document.getElementById('programToggle');
            
            if (content && toggle) {
                content.classList.toggle('expanded');
                toggle.classList.toggle('expanded');
            }
        }
        
        // Track visit on page load
        trackVisit();
    </script>

    <script src="app.js"></script>
</body>
</html>
